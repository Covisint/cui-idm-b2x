<!DOCTYPE html>
<html>
  <head>
    <title>CUI Demo</title>
    <link rel="stylesheet" href="./styles/normalize.css" />
    <link rel="stylesheet" href="./styles/tufte.css" />
    <link rel="stylesheet" href="./styles/main.css" />
    <script src="./lib/lodash.min.js"></script>
    <script src="./lib/jquery.min.js"></script>
    <script src="./lib/jquery.tabletojson.min.js"></script>
    <script src="./lib/cui.js"></script>
  </head>

  <body>
    <h1>CUI</h1>
    <p class="subtitle">Javascript Library for Covisint Products. <span class="marginnote">Fork me on <a href="https://github.com/thirdwavellc/cui">GitHub</a></span></p>

    <section>
    <h2>API Wrapper</h2>
    <p>The <span class="code">cui.api()</span> function is used to 1) establish authorization between your Application and the Covsint API Services, and 2) simplify and enhance using the API calls in a javascript client.</p>

    <h3>Set Up</h3>
    <p><span class="marginnote">Please see the CUI project's <a href="https://github.com/louismb/cui#installation">README.md</a> for installation instructions.</span>Before attempting to use this library in a project, the Application must first be created in the Covisint <a href="https://developer.covisint.com/web/guest/home">Developer Portal's</a> Solution Center. After that, it is then possible to use the Application's Client ID to dynamically obtain an API Service Authorization token, which CUI will then sent along with all subsequent API calls.</p>

    <h3>Configuration</h3>
    <p>Even with a valid token, a user (b.k.a <a href="https://developer.covisint.com/PersonV1">Person</a>) is not initially permitted to make a call against the service APIs until that user's access into the Services has been be manually and explicitly configured. This configuration can only be done via the <a href="https://developer.covisint.com/GroupV1">Group</a> service API, using App-level access. Typically, these Person-to-Group membership associations are made via the Groups' 'Try It' API utility</a> or <a href="https://github.com/postmanlabs/postman-app-support">Postman</a>.</p>

    <h3>3-Legged OAuth Authorization</h3>
    <p>Initating CUI, and then authorizing a non-system user in your code is done as follows:<span class="marginnote">CUI calls return jQuery <a href="http://learn.jquery.com/code-organization/deferreds/">deferreds</a>, which are an enhanced extension of <a href="http://wiki.commonjs.org/wiki/Promises/A">Promises</a>. This makes it possible to easily handle both success and failure events from the asynchronous API calls.</span></p>
    <pre class="code">var myCUI = cui.api();
myCUI.setService('PRD');

$('#authButton').on('click', function() { 
  myCUI.doThreeLeggedOAuth({
    clientId: '<i>YOUR CLIENT ID</i>'
  })
  .then(function() {
    <i>...YOUR Success Handler</i>
  })
  .fail(function() {
    <i>...YOUR Failure Handler</i>
  });
});

myCUI.handleAuthResponse();</pre>
    <button id="authButton">Do Auth</button>
    <p>Click the 'Do Auth' button to start the process. A popup will appear in which the authorization(s) will occur. You will first be authenticated into the (demo) Identity Realm, if you are not already logged in. Please use the following demo credentials:</p>
    <pre class="code">User = USER0002
Password = LetMeIn12!</pre>
    <p> The authorization process will then continue inside the popup where a scoped acceptance between the Identity Realm and the API Services will appear. Click 'Allow' to complete the authorization.
    <span id="authResult" class="marginnote"></span> </p>
    <button id="showTokenButton">Show Token</button>

    <p>If you complete the authorization, processing continues in the <span class="code">then()</span> handler. If you closed the popup, or 'Deny' authorization, the <span class="code">myCUI.doThreeLeggedAuth()</span> call will reject the promise and processing will continue in the <span class="code">fail()</span> handler.</p>
    <p>The generated auth token can be seen by clicking the 'Show Token' Button. This token will be sent with any subsequent API service calls. It is automatically stored and managed in browser 'local storage'. That way the <span class="code">cui.api()</span> functions can safely find it when they construct and issue any downstream data calls.</p>
    <p>Note, this token has a lifespan of 900 seconds (15 minutes), but CUI will automatically refresh the token so that it never expires during the lifetime of your session.</p>

    <h3>System-Level Authorization</h3>
    <p>Additional Auth-related functions are demonstrated below. <span class="marginnote"><em>After testing the 3-legged OAuth, use the 'Do IdM Sys Auth' button (below) to obtain a 'full-access' token, so the remainder of the demo will function properly.</em></span></p>
    <button id="sysAuthButton">Do IdM Sys Auth</button>
    <button id="revokeButton">Revoke Token</button>
    <button id="idmLogoutButton">Do IdMLogout</button>


    <h3>Data Calls - IdM</h3>
    <p>CUI makes it easy to handle both success and failure events from the asynchronous API calls. For example, consider the following <span class="code">Get Orgnizations</span> call...<span class="marginnote">The cui.log() call is built into the cui library. It is a cross-browser safe way to do console logging, which preserves original line numbers in the log. Additionally, it allows log messages to be enabled/disabled on-demand, which is helpful when debugging Production deployments. See Utils below for more information.</span></p>
    <pre class="code">myCUI.getOrganizations()
.then(function(response) {
  cui.log('getOrgs then', response);
  <i>...YOUR Success Handler</i>
})
.fail(function(response) {
  cui.log('getOrgs failed', cui.parseError(response));
  <i>...YOUR Failure Handler</i>
});</pre>
    <p><span id="idmResult3" class="marginnote"></span></p>
    <button id="idmButton3">Get Orgs</button>
    
    <br/>
    <br/>

    <p>Here is an example of how to make the same API call with an optional parameter to limit the results to just one Organization.</p>
    <pre class="code">myCUI.getOrganization({
  'organizationId': 'OPLATFORM-CUI195802'
})
.then(function(response) {
  cui.log('getOrgsWithParam then', response);
  <i>...YOUR Success Handler</i>
})
.fail(function(response) {
  cui.log('getOrgsWithParam failed', cui.parseError(response));
  <i>...YOUR Failure Handler</i>
});</pre>
    <p><span id="idmResult3b" class="marginnote"></span></p>
    <button id="idmButton3b">Get One Org</button>

    <br/>
    <br/>

    <p>Here is an example of how to make a <span class="code">Get Users</span> call.</p>
    <pre class="code">myCUI.getUsers()
.then(function(response) {
  cui.log('getUsers then', response);
  <i>...YOUR Success Handler</i>
})
.fail(function(response) {
  cui.log('getUsers failed', cui.parseError(response));
  <i>...YOUR Failure Handler</i>
});</pre>
    <p><span id="idmResult4" class="marginnote"></span></p>
    <button id="idmButton4">Get Users</button>

    <br/>
    <br/>

    <p>Here is an example of how to make a <span class="code">Get Packages</span> call.</p>
    <pre class="code">myCUI.getPackages()
.then(function(response) {
  cui.log('getPackages then', response);
  <i>...YOUR Success Handler</i>
})
.fail(function(response) {
  cui.log('getPackages failed', cui.parseError(response));
  <i>...YOUR Failure Handler</i>
});</pre>
    <p><span id="idmResult5" class="marginnote"></span></p>
    <button id="idmButton5">Get Packages</button>

    <br/>
    <br/>
    <br/>
    <br/>

    <h3>Data Calls - IoT</h3>
    <p>Here is an example of an IoT <span class="code">Create Application</span> call. <span class="marginnote">Make sure to first click the 'Do IoT Sys Auth' button (below) before trying out the IoT demo calls. Any previous IdM Authorization token is only valid against the IdM demo application.</span><span class="marginnote"><br/>The format for the body of the API calls is described in the API <a href="https://developer.covisint.com/web/guest/docapis">reference</a>. Look for the 'Show Schema' button inside the 'Body' section of each call.</span></p>
    <pre class="code">var appBody = {
  'name': [
    {
      'lang': 'en',
      'text': 'Next Killer App'
    }
  ],
  'description': [
    {
      'lang': 'en',
      'text': 'Hybrid, single-page-app.'
    }
  ]
};
myCUI.createApplication({data: appBody})
.then(function(response) {
  cui.log('createApplication then', response);
  <i>...YOUR Success Handler</i>
})
.fail(function(response) {
  cui.log('createApplication failed', cui.parseError(response));
  <i>...YOUR Failure Handler</i>
});</pre>
    <p><span id="iotResult1a" class="marginnote"></span></p>
    <button id="iotSysAuthButton">Do IoT Sys Auth</button>
    <button id="iotButton1a">Create Application</button>

    <p>Here is an example of an IoT <span class="code">Get Applications</span> call.</p>
    <pre class="code">myCUI.getApplications()
.then(function(response) {
  cui.log('getApplications then', response);
  <i>...YOUR Success Handler</i>
})
.fail(function(response) {
  cui.log('getApplications failed', cui.parseError(response));
  <i>...YOUR Failure Handler</i>
});</pre>
    <p><span id="iotResult1" class="marginnote"></span></p>
    <button id="iotButton1">Get Applications</button>

    <br/>
    <br/>
    <p>Here is an example of a <span class="code">Get Devices</span> call. <span class="marginnote">Make sure to click the 'Do IOT Sys Auth' button (above) to get access to the IoT demo Application's data.</span></p>
    <pre class="code">myCUI.getDevices()
.then(function(response) {
  cui.log('getDevices then', response);
  <i>...YOUR Success Handler</i>
})
.fail(function(response) {
  cui.log('getDevices failed', cui.parseError(response));
  <i>...YOUR Failure Handler</i>
});</pre>    
    <p><span id="iotResult2" class="marginnote"></span></p>
    <button id="iotButton2">Get Devices</button>

    <p>Here is an example of a <span class="code">Create Device From Template</span> call.</p>
    <pre class="code">myCUI.createDeviceFromTemplate({'deviceTemplateId':'<i>...YOUR DeviceTemplateID</i>'})
.then(function(response) {
  cui.log('createDeviceFromTemplate then', response);
  <i>...YOUR Success Handler</i>
})
.fail(function(response) {
  cui.log('createDeviceFromTemplate failed', cui.parseError(response));
  <i>...YOUR Failure Handler</i>
});</pre>    
    <p><span id="iotResult2a" class="marginnote"></span></p>
    <button id="iotButton2a">Create Device From Template</button>

    <br/>
    <br/>
    <p>Here is an example of a <span class="code">Get Device Templates</span> call.</p>
    <pre class="code">myCUI.getDeviceTemplates()
.then(function(response) {
  cui.log('getDeviceTemplates then', response);
  <i>...YOUR Success Handler</i>
})
.fail(function(response) {
  cui.log('getDeviceTemplates failed', cui.parseError(response));
  <i>...YOUR Failure Handler</i>
});</pre>
    <p><span id="iotResult3" class="marginnote"></span></p>
    <button id="iotButton3">Get Device Templates</button>

    <p>Here is an example of a <span class="code">Create Device Template</span> call.</p>
    <pre class="code">var appBody = { <i>...YOUR Body</i> };
myCUI.createDeviceTemplate({data: appBody})
.then(function(response) {
  cui.log('createDeviceTemplate then', response);
  <i>...YOUR Success Handler</i>
})
.fail(function(response) {
  cui.log('createDeviceTemplate failed', cui.parseError(response));
  <i>...YOUR Failure Handler</i>
});</pre>
    <p><span id="iotResult3a" class="marginnote"></span></p>
    <button id="iotButton3a">Create Device Template</button>

    <br/>
    <br/>
    <p>Here is an example of a <span class="code">Get Event Sources</span> call.</p>
    <pre class="code">myCUI.getEventSources()
.then(function(response) {
  cui.log('getEventSources then', response);
  <i>...YOUR Success Handler</i>
})
.fail(function(response) {
  cui.log('getEventSources failed', cui.parseError(response));
  <i>...YOUR Failure Handler</i>
});</pre>    
    <p><span id="iotResult4" class="marginnote"></span></p>
    <button id="iotButton4">Get Event Sources</button>

    <br/>
    <br/>
    <p>Here is an example of a <span class="code">Get Event Templates</span> call.</p>
    <pre class="code">myCUI.getEventTemplates()
.then(function(response) {
  cui.log('getEventTemplates then', response);
  <i>...YOUR Success Handler</i>
})
.fail(function(response) {
  cui.log('getEventTemplates failed', cui.parseError(response));
  <i>...YOUR Failure Handler</i>
});</pre>    
    <p><span id="iotResult5" class="marginnote"></span></p>
    <button id="iotButton5">Get Event Templates</button>

    <p>Here is an example of a <span class="code">Create Event Template</span> call.</p>
    <pre class="code">var appBody = { <i>...YOUR Body</i> };
myCUI.createEventTemplate({data: appBody})
.then(function(response) {
  cui.log('createEventTemplate then', response);
  <i>...YOUR Success Handler</i>
})
.fail(function(response) {
  cui.log('createEventTemplate failed', cui.parseError(response));
  <i>...YOUR Failure Handler</i>
});</pre>
    <p><span id="iotResult5a" class="marginnote"></span></p>
    <button id="iotButton5a">Create Event Template</button>


    <br/>
    <br/>
    <p>Here is an example of a <span class="code">Get Attribute Types</span> call.</p>
    <pre class="code">myCUI.getAttributeTypes()
.then(function(response) {
  cui.log('getAttributeTypes then', response);
  <i>...YOUR Success Handler</i>
})
.fail(function(response) {
  cui.log('getAttributeTypes failed', cui.parseError(response));
  <i>...YOUR Failure Handler</i>
});</pre>    
    <p><span id="iotResult6" class="marginnote"></span></p>
    <button id="iotButton6">Get Attribute Types</button>

    <p>Here is an example of a <span class="code">Create Attribute Type</span> call.</p>
    <pre class="code">var appBody = { <i>...YOUR Body</i> };
myCUI.createAttributeType({data: appBody})
.then(function(response) {
  cui.log('createAttributeType then', response);
  <i>...YOUR Success Handler</i>
})
.fail(function(response) {
  cui.log('createAttributeType failed', cui.parseError(response));
  <i>...YOUR Failure Handler</i>
});</pre>
    <p><span id="iotResult6a" class="marginnote"></span></p>
    <button id="iotButton6a">Create Attribute Type</button>


    <br/>
    <br/>
    <p>Here is an example of a <span class="code">Get Command Types</span> call.</p>
    <pre class="code">myCUI.getCommandTemplates()
.then(function(response) {
  cui.log('getCommandTemplates then', response);
  <i>...YOUR Success Handler</i>
})
.fail(function(response) {
  cui.log('getCommandTemplates failed', cui.parseError(response));
  <i>...YOUR Failure Handler</i>
});</pre>    
    <p><span id="iotResult7" class="marginnote"></span></p>
    <button id="iotButton7">Get Command Templates</button>

    <p>Here is an example of a <span class="code">Create Command Template</span> call.</p>
    <pre class="code">var appBody = { <i>...YOUR Body</i> };
myCUI.createCommandTemplate({data: appBody})
.then(function(response) {
  cui.log('createCommandTemplate then', response);
  <i>...YOUR Success Handler</i>
})
.fail(function(response) {
  cui.log('createCommandTemplate failed', cui.parseError(response));
  <i>...YOUR Failure Handler</i>
});</pre>
    <p><span id="iotResult7a" class="marginnote"></span></p>
    <button id="iotButton7a">Create Command Template</button>


    <br/>
    <br/>
    <br/>
    <br/>
    <p>The Promise architecture inside CUI also makes it possible chain multiple asynchronous data calls and then perform downstream operation(s) when all the calls have successfully completed. For example, consider the following code, which gets data via multiple asynchronous calls, and then will use that data, once all of it arrives, to bind to markup.</p>
    <pre class="code">$.when(
  myCUI.getOrganizations(),
  myCUI.getUsers(),
  myCUI.getPackages(),
)
.then(function() {
  <i>...YOUR Success Handler</i>
})
.fail(function() {
  <i>...YOUR Failure Handler</i>
});      
    </pre>
    
    </section>

    <section>
    <h2>Utilities</h2>
    <p><em>todo</em></p>
    <h3>Topic 1</h3>
    <h3>Topic 2</h3>
    </section>

    <footer>
      <hr>
      <p>Copyright 2015 Covisint Corp.</p>
      <p>Fork me on <a href="https://github.com/thirdwavellc/cui">GitHub</a></p>
    </footer>


    <script src="./scripts/hello.js"></script>
    <!--<script src="./scripts/deferred.js"></script>-->
    <script src="./scripts/api-demo.js"></script>

  </body>
</html>
