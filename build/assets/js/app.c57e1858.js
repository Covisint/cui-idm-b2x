!function(angular){"use strict";angular.module("app",["translate","ngMessages","cui.authorization","cui-ng","ui.router","snap","LocalStorageModule"]).run(["$rootScope","$state","cui.authorization.routing",function($rootScope,$state,routing){}]),angular.module("app").factory("API",[function(){var myCUI=cui.api();myCUI.setServiceUrl("PRD");var doAuth=function(){return myCUI.doSysAuth({clientId:"wntKAjev5sE1RhZCHzXQ7ko2vCwq3wi2",clientSecret:"MqKZsqUtAVAIiWkg"})},token=function(){return myCUI.getToken()};return{token:token,cui:myCUI,doAuth:doAuth}}]),angular.module("app").controller("baseCtrl",["$state","getCountries","$scope","$translate","LocaleService",function($state,getCountries,$scope,$translate,LocaleService){var base=this;base.desktopMenu=!0,base.toggleDesktopMenu=function(){base.desktopMenu=!base.desktopMenu},base.goBack=function(){""!==$state.previous.name.name?$state.go($state.previous.name,$state.previous.params):$state.go("base")},base.generateHiddenPassword=function(password){return Array(password.length+1).join("â€¢")},base.passwordPolicies=[{allowUpperChars:!0,allowLowerChars:!0,allowNumChars:!0,allowSpecialChars:!0,requiredNumberOfCharClasses:3},{disallowedChars:"^&*)(#$"},{min:8,max:18},{disallowedWords:["password","admin"]}],base.getLanguageCode=function(){return LocaleService.getLocaleCode().indexOf("_")>-1?LocaleService.getLocaleCode().split("_")[0]:LocaleService.getLocaleCode()};var setCountries=function(language){language=language||"en",language.indexOf("_")>-1&&(language=language.split("_")[0]),getCountries(language).then(function(res){base.countries=res.data})["catch"](function(err){console.log(err)})};$scope.$on("languageChange",function(e,args){setCountries(args)}),setCountries($translate.proposedLanguage())}]),angular.module("app").config(["$translateProvider","$locationProvider","$stateProvider","$urlRouterProvider","$injector","localStorageServiceProvider","$cuiIconProvider","$cuiI18nProvider",function($translateProvider,$locationProvider,$stateProvider,$urlRouterProvider,$injector,localStorageServiceProvider,$cuiIconProvider,$cuiI18nProvider){localStorageServiceProvider.setPrefix("cui");var templateBase="assets/angular-templates/",returnCtrlAs=function(name,asPrefix){return name+"Ctrl as "+(asPrefix?asPrefix:"")+(asPrefix?name[0].toUpperCase()+name.slice(1,name.length):name)};$stateProvider.state("base",{url:"/",templateUrl:templateBase+"base.html",controller:returnCtrlAs("base")}).state("users",{url:"/users",templateUrl:templateBase+"users/users.html"}).state("users.search",{url:"/",templateUrl:templateBase+"users/users.search/users.search.html",controller:returnCtrlAs("usersSearch")}).state("users.edit",{url:"/edit/:id",templateUrl:templateBase+"edit/users.edit/users.edit.html",controller:returnCtrlAs("usersEdit")}).state("users.invitations",{url:"/invitations",templateUrl:templateBase+"invitations/users.invitations/users.invitations.search.html",controller:returnCtrlAs("usersInvitations")}).state("users.invite",{url:"/invite",templateUrl:templateBase+"invitations/users.invitations/users.invite.html",controller:returnCtrlAs("usersInvite")}).state("users.register",{url:"/register?id&code",templateUrl:templateBase+"registration/userInvited/users.register.html",controller:returnCtrlAs("usersRegister")}).state("users.walkupRegistration",{url:"/walkupRegistration",templateUrl:templateBase+"registration/userWalkup/users.walkup.html",controller:returnCtrlAs("usersWalkup")}).state("users.activate",{url:"/activate/:id",templateUrl:templateBase+"users/users.activate/users.activate.html",controller:returnCtrlAs("usersActivate")}).state("applications",{url:"/applications",templateUrl:templateBase+"applications/applications.html"}).state("applications.myApplications",{url:"/myApplications",templateUrl:templateBase+"applications/myApplications.html",controller:returnCtrlAs("myApplications")}).state("applications.myApplicationDetails",{url:"/myApplications/:packageId/:appId",templateUrl:templateBase+"applications/myApplicationDetails.html",controller:returnCtrlAs("myApplicationDetails")}).state("applications.newRequest",{url:"/newRequest",templateUrl:templateBase+"applications/newRequest.html",controller:returnCtrlAs("newAppRequest")}).state("applications.search",{url:"/search/:name",templateUrl:templateBase+"applications/search.html",controller:returnCtrlAs("applicationSearch")}).state("welcome",{url:"/welcome",templateUrl:templateBase+"welcome/welcome.html"}).state("welcome.screen",{url:"/welcome",templateUrl:templateBase+"welcome/welcome.screen.html",controller:returnCtrlAs("welcome")}).state("tlo",{url:"/tlo",templateUrl:templateBase+"registration/newTopLevelOrg/topLevelOrg.html"}).state("tlo.registration",{url:"/registration",templateUrl:templateBase+"registration/newTopLevelOrg/topLevelOrg.registration/topLevelOrg.registration.html",controller:returnCtrlAs("tlo","new")}).state("division",{url:"/division",templateUrl:templateBase+"registration/newDivision/division.html"}).state("division.registration",{url:"/registration",templateUrl:templateBase+"registration/newDivision/division.registration/division.registration.html",controller:returnCtrlAs("division","new")}).state("misc",{url:"/status",templateUrl:templateBase+"misc/misc.html"}).state("misc.404",{url:"/404",templateUrl:templateBase+"misc/misc.404.html"}).state("misc.notAuth",{url:"/notAuthorized",templateUrl:templateBase+"misc/misc.notAuth.html"}).state("misc.pendingStatus",{url:"/pendingStatus",templateUrl:templateBase+"misc/misc.pendingStatus.html"}).state("misc.success",{url:"/success",templateUrl:templateBase+"misc/misc.success.html"}).state("profile",{url:"/profile",templateUrl:templateBase+"profiles/profile.html"}).state("profile.organization",{url:"/profile/organization?id",templateUrl:templateBase+"profiles/organization.profile.html",controller:returnCtrlAs("orgProfile")}),$urlRouterProvider.otherwise(function($injector){var $state=$injector.get("$state");$state.go("base")}),$cuiI18nProvider.setLocaleCodesAndNames({en:"English",pt:"Portuguese",pl:"Polish",zh:"Chinese"});var languageKeys=Object.keys($cuiI18nProvider.getLocaleCodesAndNames()),returnRegisterAvailableLanguageKeys=function(){var object={"*":languageKeys[0]};return languageKeys.forEach(function(languageKey){object[languageKey+"*"]=languageKey}),object};$translateProvider.useLoader("LocaleLoader",{url:"bower_components/cui-i18n/dist/cui-i18n/angular-translate/",prefix:"locale-",suffix:".json"}).registerAvailableLanguageKeys(languageKeys,returnRegisterAvailableLanguageKeys()).uniformLanguageTag("java").determinePreferredLanguage().fallbackLanguage(languageKeys),$cuiI18nProvider.setLocalePreference(languageKeys),$cuiIconProvider.iconSet("cui","bower_components/cui-icons/dist/icons/icons-out.svg",48,!0),$cuiIconProvider.iconSet("fa","bower_components/cui-icons/dist/font-awesome/font-awesome-out.svg",216,!0)}]),angular.module("app").run(["LocaleService","$rootScope","$state","$http","$templateCache","$cuiI18n",function(LocaleService,$rootScope,$state,$http,$templateCache,$cuiI18n){var languageNameObject=$cuiI18n.getLocaleCodesAndNames();for(var LanguageKey in languageNameObject)LocaleService.setLocales(LanguageKey,languageNameObject[LanguageKey]);$rootScope.$on("$stateChangeSuccess",function(event,toState,toParams,fromState,fromParams){$state.previous={},$state.previous.name=fromState,$state.previous.params=fromParams});var icons=["bower_components/cui-icons/dist/icons/icons-out.svg","bower_components/cui-icons/dist/font-awesome/font-awesome-out.svg"];angular.forEach(icons,function(icon){$http.get(icon,{cache:$templateCache})})}]),angular.module("app").controller("applicationSearchCtrl",["API","$scope","$stateParams","$state",function(API,$scope,$stateParams,$state){var user,userId="RN3BJI54";$stateParams.name;API.doAuth().then(function(res){return API.cui.getPerson({personId:userId})}).then(function(res){return user=res,API.cui.getOrganization}).fail(function(err){console.log(err)})}]),angular.module("app").controller("myApplicationDetailsCtrl",["API","$scope","$stateParams","$state",function(API,$scope,$stateParams,$state){var myApplicationDetails=this,userId="RN3BJI54",appId=$stateParams.appId,packageId=$stateParams.packageId,handleError=function(err){console.log("Error \n",err),myApplicationDetails.doneLoading=!0,$scope.$digest()},i=0,getDateGranted=function(creationUnixStamp){var dateGranted=new Date(creationUnixStamp),dateGrantedFormatted=dateGranted.getMonth()+"."+dateGranted.getDay()+"."+dateGranted.getFullYear();return dateGrantedFormatted},getBundledApps=function(service){myApplicationDetails.bundled=[],API.cui.getServices({packageId:packageId}).then(function(res){i++,res.forEach(function(app){app.id!==myApplicationDetails.app.id&&(app.grantedDate=service.grantedDate,app.status=service.status,app.parentPackage=packageId,myApplicationDetails.bundled.push(app))}),2===i&&(myApplicationDetails.doneLoading=!0,$scope.$digest())}).fail(handleError)},getRelatedApps=function(servicePackage){myApplicationDetails.related=[],API.cui.getPackages({"parentPackage.id":packageId}).then(function(res){0===res.length&&(i++,2===i&&(myApplicationDetails.doneLoading=!0,$scope.$digest())),res.forEach(function(pkg,i){var status=[],grantedDate=[];API.cui.getPersonPackage({packageId:pkg.id,personId:userId}).then(function(res){return 0!==Object.keys(res).length&&(status[i]=res.status,grantedDate[i]=getDateGranted(res.creation)),API.cui.getServices({packageId:packageId})}).then(function(res){i++,res.forEach(function(app){status[i]&&(app.status=status[i],app.grantedDate=grantedDate[i]),app.parentPackage=pkg.id,myApplicationDetails.related.push(app)}),2===i&&(myApplicationDetails.doneLoading=!0,$scope.$digest())}).fail(handleError)})}).fail(handleError)},getPackageGrantDetails=function(app){API.cui.getPersonPackage({personId:userId,packageId:packageId}).then(function(res){app.grantedDate=getDateGranted(res.creation),app.status=res.status,myApplicationDetails.app=app,getBundledApps(app),getRelatedApps(app)}).fail(handleError)};appId&&API.doAuth().then(function(res){return API.cui.getService({serviceId:appId})}).then(function(res){var app=res;getPackageGrantDetails(app)}).fail(handleError),myApplicationDetails.goToDetails=function(application){$state.go("applications.myApplicationDetails",{packageId:application.parentPackage,appId:application.id})}}]),angular.module("app").controller("myApplicationsCtrl",["API","$scope","$state",function(API,$scope,$state){var myApplications=this,userId="RN3BJI54";myApplications.list=[];var handleError=function(err){console.log("Error \n\n",err)},getApplicationsFromGrants=function(grants){var i=0;grants.forEach(function(grant){API.cui.getPackageServices({packageId:grant.servicePackage.id}).then(function(res){i++,res.forEach(function(service){service.status=grant.status,service.parentPackage=grant.servicePackage.id,myApplications.list.push(service)}),i===grants.length&&(myApplications.doneLoading=!0,$scope.$digest())}).fail(handleError)})};API.doAuth().then(function(res){return API.cui.getPersonPackages({personId:userId})}).then(function(res){getApplicationsFromGrants(res)}).fail(handleError),myApplications.goToDetails=function(application){$state.go("applications.myApplicationDetails",{packageId:application.parentPackage,appId:application.id})}}]),angular.module("app").controller("newAppRequestCtrl",["API","$scope","$state",function(API,$scope,$state){}]),angular.module("app").controller("usersEditCtrl",["localStorageService","$scope","$stateParams","$timeout","API",function(localStorageService,$scope,$stateParams,$timeout,API){var usersEdit=this;usersEdit.loading=!0,usersEdit.timezones=["AKST1AKDT","PST2PDT","MST3MDT","CST4CDT","EST5EDT"];var initializeFullNameTemp=function(){usersEdit.tempGiven=usersEdit.user.name.given,usersEdit.tempSurname=usersEdit.user.name.surname},initializeTempAddressValues=function(){usersEdit.tempStreetAddress=usersEdit.user.addresses[0].streets[0],usersEdit.tempAddress2=usersEdit.user.addresses[0].streets[1],usersEdit.tempCity=usersEdit.user.addresses[0].city,usersEdit.tempZIP=usersEdit.user.addresses[0].postal,usersEdit.tempCountry=usersEdit.user.addresses[0].country},selectQuestionsForUser=function(){var questions=[];angular.forEach(usersEdit.userSecurityQuestions.questions,function(userQuestion){var question=_.find(usersEdit.allSecurityQuestions,function(question){return question.id===userQuestion.question.id});this.push(question)},questions),usersEdit.challengeQuestion1=questions[0],usersEdit.challengeQuestion2=questions[1]},initializePhones=function(){usersEdit.phoneTypes=["main","mobile","fax"],usersEdit.phones=[],angular.forEach(usersEdit.phoneTypes,function(type){var phoneObject={type:type,number:filterPhones(type)};usersEdit.phones.push(phoneObject)})},filterPhones=function(type){var phones=usersEdit.user.phones,filteredPhones=phones.filter(function(item){return item.type===type});return filteredPhones.length>0?filteredPhones[0].number:""};API.doAuth().then(function(res){return API.cui.getPerson({personId:$stateParams.id})}).then(function(res){return usersEdit.user=res,initializeTempAddressValues(),initializeFullNameTemp(),initializePhones(),API.cui.getSecurityQuestionAccount({personId:usersEdit.user.id})}).then(function(res){return usersEdit.userSecurityQuestions=res,$scope.$apply(),API.cui.getSecurityQuestions()}).then(function(res){return usersEdit.allSecurityQuestions=res,selectQuestionsForUser(),$scope.$apply(),API.cui.getPersonPassword({personId:usersEdit.user.id})}).then(function(res){usersEdit.userPassword=res,$scope.$apply(),usersEdit.loading=!1}).fail(function(err){$scope.$apply(),usersEdit.loading=!1}),usersEdit.save=function(){usersEdit.saving=!0,usersEdit.fail=!1,usersEdit.success=!1,API.cui.updatePerson({personId:$stateParams.id,data:usersEdit.user}).then(function(res){$timeout(function(){usersEdit.saving=!1,usersEdit.success=!0},300)}).fail(function(err){$timeout(function(){usersEdit.saving=!1,usersEdit.fail=!0},300)})},usersEdit.saveFullName=function(){usersEdit.user.name.given=usersEdit.tempGiven,usersEdit.user.name.surname=usersEdit.tempSurname,usersEdit.save()},usersEdit.resetFullName=function(){usersEdit.tempGiven=usersEdit.user.name.given,usersEdit.tempSurname=usersEdit.user.name.surname},usersEdit.resetTempAddress=function(){initializeTempAddressValues()},usersEdit.saveAddress=function(){usersEdit.user.addresses[0].streets[0]=usersEdit.tempStreetAddress,usersEdit.tempAddress2&&(usersEdit.user.addresses[0].streets[1]=usersEdit.tempAddress2),usersEdit.user.addresses[0].city=usersEdit.tempCity,usersEdit.user.addresses[0].postal=usersEdit.tempZIP,usersEdit.user.addresses[0].country=usersEdit.tempCountry},usersEdit.updateTempCountry=function(results){usersEdit.tempCountry=results.description.name},usersEdit.clearAdditionalPhone=function(){usersEdit.additionalPhoneType="",usersEdit.additionalPhoneNumber=""},usersEdit.savePhone=function(){usersEdit.user.phones=usersEdit.phones.slice(),_.remove(usersEdit.user.phones,function(phone){return""==phone.number}),usersEdit.save()},usersEdit.resetChallengeQuestion=function(question){usersEdit["challengeAnswer"+question]="",selectQuestionsForUser()}}]),angular.module("app").factory("getCountries",["$http",function($http){return function(locale){return $http.get("bower_components/cui-i18n/dist/cui-i18n/angular-translate/countries/"+locale+".json")}}]),angular.module("app").controller("usersInvitationsCtrl",["localStorageService","$scope","$stateParams","API","$timeout",function(localStorageService,$scope,$stateParams,API,$timeout){var usersInvitations=this;usersInvitations.listLoading=!0,usersInvitations.invitor=[],usersInvitations.invitee=[],usersInvitations.invitorLoading=[],usersInvitations.inviteeLoading=[],API.cui.getPersonInvitations().then(function(res){usersInvitations.listLoading=!1,usersInvitations.list=res,$scope.$apply()}).fail(function(err){usersInvitations.listLoading=!1,console.log(err)}),usersInvitations.getInfo=function(invitorId,inviteeId,index){void 0===usersInvitations.invitor[index]&&(usersInvitations.invitorLoading[index]=!0,usersInvitations.inviteeLoading[index]=!0,API.cui.getPerson({personId:invitorId}).then(function(res){usersInvitations.invitor[index]=res,$scope.$apply(),$timeout(function(){usersInvitations.invitorLoading[index]=!1},500)}).fail(function(err){console.log(err)}),API.cui.getPerson({personId:inviteeId}).then(function(res){usersInvitations.invitee[index]=res,$scope.$apply(),$timeout(function(){usersInvitations.inviteeLoading[index]=!1},500)}).fail(function(err){console.log(err)}))}}]),angular.module("app").controller("usersInviteCtrl",["localStorageService","$scope","$stateParams","API",function(localStorageService,$scope,$stateParams,API){var usersInvite=this;usersInvite.user={},usersInvite.user.organization={id:"OCOVSMKT-CVDEV204002",type:"organization",realm:"APPCLOUD"};var sendInvitationEmail=function(invitation){var message="You've received an invitation to join our organization.<p><a href='localhost:9001/#/users/register?id="+invitation.id+"&code="+invitation.invitationCode+"'>Click here to register</a>.";console.log(message),usersInvite.sending=!1,usersInvite.sent=!0,$scope.$digest()};usersInvite.saveUser=function(form){angular.forEach(form.$error,function(field){angular.forEach(field,function(errorField){errorField.$setTouched()})}),form.$valid&&(usersInvite.sending=!0,usersInvite.sent=!1,usersInvite.fail=!1,usersInvite.user.timezone="EST5EDT",usersInvite.user.language=$scope.$parent.base.getLanguageCode(),API.doAuth().then(function(){return API.cui.createPerson({data:usersInvite.user})}).then(function(res){return API.cui.createPersonInvitation({data:build.personInvitation(res)})}).then(function(res){sendInvitationEmail(res)}).fail(function(err){usersInvite.sending=!1,usersInvite.fail=!0,$scope.$digest()}))};var build={personInvitation:function(invitee){return{email:invitee.email,invitor:{id:"RN3BJI54",type:"person"},invitee:{id:invitee.id,type:"person"},targetOrganization:{id:"OCOVSMKT-CVDEV204002",type:"organization"}}}}}]),angular.module("app").factory("Person",["$http","$q","API",function($http,$q,API){var getById=function(id){return $http({method:"GET",url:API.cui.getServiceUrl()+"/person/v1/persons/"+id,headers:{Accept:"application/vnd.com.covisint.platform.person.v1+json",Authorization:"Bearer "+API.token()}}).then(function(res){return res})["catch"](function(res){return $q.reject(res)})},getInvitations=function(){return $http({method:"GET",url:API.cui.getServiceUrl()+"/person/v1/personInvitations/",headers:{Accept:"application/vnd.com.covisint.platform.person.invitation.v1+json",Authorization:"Bearer "+API.token()}}).then(function(res){return res})["catch"](function(res){return $q.reject(res)})},getInvitationById=function(id){return $http({method:"GET",url:API.cui.getServiceUrl()+"/person/v1/personInvitations/"+id,headers:{Accept:"application/vnd.com.covisint.platform.person.invitation.v1+json",Authorization:"Bearer "+API.token()}}).then(function(res){return res})["catch"](function(res){return $q.reject(res)})},createInvitation=function(invitee,invitor){return $http({method:"POST",url:API.cui.getServiceUrl()+"/person/v1/personInvitations",headers:{Accept:"application/vnd.com.covisint.platform.person.invitation.v1+json",Authorization:"Bearer "+API.token(),"Content-type":"application/vnd.com.covisint.platform.person.invitation.v1+json"},data:{email:invitee.email,invitor:{id:invitor.id,type:"person"},invitee:{id:invitee.id,type:"person"},targetOrganization:{id:"OCOVSMKT-CVDEV204002",type:"organization"}}}).then(function(res){return res})["catch"](function(res){return $q.reject(res)})},update=function(id,data){return $http({method:"PUT",url:API.cui.getServiceUrl()+"/person/v1/persons/"+id,headers:{Accept:"application/vnd.com.covisint.platform.person.v1+json",Authorization:"Bearer "+API.token(),"Content-Type":"application/vnd.com.covisint.platform.person.v1+json"},data:data}).then(function(res){return res})["catch"](function(res){return $q.reject(res)})},create=function(data){return $http({method:"POST",url:API.cui.getServiceUrl()+"/person/v1/persons",headers:{Accept:"application/vnd.com.covisint.platform.person.v1+json",Authorization:"Bearer "+API.token(),"Content-Type":"application/vnd.com.covisint.platform.person.v1+json"},data:data}).then(function(res){return res})["catch"](function(res){return $q.reject(res)})},sendUserInvitationEmail=function(body){return $http({method:"POST",url:"http://localhost:8000/invitation/person","Content-Type":"application/json",data:body}).then(function(res){return res})["catch"](function(err){return $q.reject(err)})},getSecurityQuestions=function(){return $http({method:"GET",url:API.cui.getServiceUrl()+"/authn/v2/securityQuestions",headers:{Accept:"application/vnd.com.covisint.platform.securityquestion.v1+json",Authorization:"Bearer "+API.token()}}).then(function(res){return res})["catch"](function(err){return $q.reject(err)})},getPasswordAccount=function(id){return $http({method:"GET",url:API.cui.getServiceUrl()+"/person/v1/persons/"+id+"/accounts/password",headers:{Accept:"application/vnd.com.covisint.platform.person.account.password.v1+json",Authorization:"Bearer "+API.token()}}).then(function(res){return res})["catch"](function(err){return $q.reject(err)})},createPasswordAccount=function(id,data){return $http({method:"PUT",url:API.cui.getServiceUrl()+"/person/v1/persons/"+id+"/accounts/password",headers:{Accept:"application/vnd.com.covisint.platform.person.account.password.v1+json",Authorization:"Bearer "+API.token(),"Content-Type":"application/vnd.com.covisint.platform.person.account.password.v1+json"},data:data}).then(function(res){return res})["catch"](function(err){return $q.reject(err)})},createSecurityQuestions=function(id,data){return $http({method:"PUT",url:API.cui.getServiceUrl()+"/authn/v2/persons/"+id+"/accounts/securityQuestion",headers:{Accept:"application/vnd.com.covisint.platform.person.account.securityQuestion.v1+json",Authorization:"Bearer "+API.token(),"Content-Type":"application/vnd.com.covisint.platform.person.account.securityQuestion.v1+json"},data:data}).then(function(res){return res})["catch"](function(err){return $q.reject(err)})},grantExchangePackage=function(id){return $http({method:"PUT",url:API.cui.getServiceUrl()+"/service/v1/persons/"+id+"/packages/PCOVSMKT-CVDEV204003000",headers:{Accept:"application/vnd.com.covisint.platform.package.grant.v1+json",Authorization:"Bearer "+API.token(),"Content-Type":"application/vnd.com.covisint.platform.package.grant.v1+json"},data:{version:1,grantee:{id:id,type:"person"},servicePackage:{id:"PCOVSMKT-CVDEV204003000"}}}).then(function(res){return res})["catch"](function(err){return $q.reject(err)})},grantCcaPackage=function(id){return $http({method:"PUT",url:API.cui.getServiceUrl()+"/service/v1/persons/"+id+"/packages/PAPC2040605",headers:{Accept:"application/vnd.com.covisint.platform.package.grant.v1+json",Authorization:"Bearer "+API.token(),"Content-Type":"application/vnd.com.covisint.platform.package.grant.v1+json"},data:{version:1,grantee:{id:id,type:"person"},servicePackage:{id:"PAPC2040605"}}}).then(function(res){return res})["catch"](function(err){return $q.reject(err)})},person={getAll:API.cui.getUsers,getById:getById,update:update,getInvitations:getInvitations,create:create,createInvitation:createInvitation,sendUserInvitationEmail:sendUserInvitationEmail,getInvitationById:getInvitationById,getSecurityQuestions:getSecurityQuestions,getPasswordAccount:getPasswordAccount,createPasswordAccount:createPasswordAccount,createSecurityQuestions:createSecurityQuestions,grantCcaPackage:grantCcaPackage,grantExchangePackage:grantExchangePackage};return person}]),angular.module("app").controller("orgProfileCtrl",["$scope","$stateParams","API",function($scope,$stateParams,API){var orgProfile=this;orgProfile.organization={},API.doAuth().then(function(){return API.cui.getOrganization({organizationId:$stateParams.id})}).then(function(res){orgProfile.organization=res,$scope.$digest()}).fail(function(error){console.log(error)})}]),angular.module("app").controller("divisionCtrl",["$scope","API","Person",function($scope,API,Person){var newDivision=this;newDivision.userLogin={},newDivision.orgSearch={},newDivision.passwordPolicies=[{allowUpperChars:!0,allowLowerChars:!0,allowNumChars:!0,allowSpecialChars:!0,requiredNumberOfCharClasses:3},{disallowedChars:"^&*)(#$"},{min:8,max:18},{disallowedWords:["password","admin"]}],Person.getSecurityQuestions().then(function(res){res.data.splice(0,1);var numberOfQuestions=res.data.length,numberOfQuestionsFloor=Math.floor(numberOfQuestions/2);newDivision.userLogin.challengeQuestions1=res.data.slice(0,numberOfQuestionsFloor),newDivision.userLogin.challengeQuestions2=res.data.slice(numberOfQuestionsFloor),newDivision.userLogin.question1=newDivision.userLogin.challengeQuestions1[0],newDivision.userLogin.question2=newDivision.userLogin.challengeQuestions2[0]})["catch"](function(err){}),API.doAuth().then(function(){API.cui.getOrganizations().then(function(res){newDivision.organizationList=res})}).fail(function(err){console.log(err)});var searchOrganizations=function(){newDivision.orgSearch&&API.cui.getOrganizations({qs:[["name",newDivision.orgSearch.name]]}).then(function(res){newDivision.organizationList=res,$scope.$apply()}).fail(function(err){console.log(err)})};$scope.$watchCollection("newDivision.orgSearch",searchOrganizations)}]),angular.module("app").controller("tloCtrl",["$scope","API","Person",function($scope,API,Person){var newTLO=this;newTLO.userLogin={},newTLO.passwordPolicies=[{allowUpperChars:!0,allowLowerChars:!0,allowNumChars:!0,allowSpecialChars:!0,requiredNumberOfCharClasses:3},{disallowedChars:"^&*)(#$"},{min:8,max:18},{disallowedWords:["password","admin"]}],Person.getSecurityQuestions().then(function(res){res.data.splice(0,1);var numberOfQuestions=res.data.length,numberOfQuestionsFloor=Math.floor(numberOfQuestions/2);newTLO.userLogin.challengeQuestions1=res.data.slice(0,numberOfQuestionsFloor),newTLO.userLogin.challengeQuestions2=res.data.slice(numberOfQuestionsFloor),newTLO.userLogin.question1=newTLO.userLogin.challengeQuestions1[0],newTLO.userLogin.question2=newTLO.userLogin.challengeQuestions2[0]})["catch"](function(err){console.log(err)})}]),angular.module("app").controller("usersRegisterCtrl",["localStorageService","$scope","Person","$stateParams","API","$state",function(localStorageService,$scope,Person,$stateParams,API,$state){var usersRegister=this;usersRegister.loading=!0,usersRegister.userLogin={},usersRegister.registrationError=!1,usersRegister.applications={},usersRegister.applications.numberOfSelected=0,usersRegister.showCovisintInfo=!1,usersRegister.submitting=!1,usersRegister.targetOrganization={};var getUser=function(id){return API.cui.getPerson({personId:id})},getOrganization=function(id){return API.cui.getOrganization({organizationId:id})};usersRegister.passwordPolicies=[{allowUpperChars:!0,allowLowerChars:!0,allowNumChars:!0,allowSpecialChars:!0,requiredNumberOfCharClasses:3},{disallowedChars:"^&*)(#$"},{min:8,max:18},{disallowedWords:["password","admin"]}],API.doAuth().then(function(){return $stateParams.id&&$stateParams.code?API.cui.getPersonInvitation({invitationId:$stateParams.id}):void console.log("Invited user reg requires 2 url params: id (invitationId) and code (invitatioCode)")}).then(function(res){return res.invitationCode===$stateParams.code?getUser(res.invitee.id):void 0}).then(function(res){return usersRegister.invitedUser=res,usersRegister.user=res,usersRegister.user.addresses=[],usersRegister.user.addresses[0]={streets:[]},usersRegister.user.phones=[],getOrganization(res.organization.id)}).then(function(res){return usersRegister.targetOrganization=res,API.cui.getSecurityQuestions()}).then(function(res){res.splice(0,1);var numberOfQuestions=res.length,numberOfQuestionsFloor=Math.floor(numberOfQuestions/2);usersRegister.userLogin.challengeQuestions1=res.slice(0,numberOfQuestionsFloor),usersRegister.userLogin.challengeQuestions2=res.slice(numberOfQuestionsFloor),usersRegister.userLogin.question1=usersRegister.userLogin.challengeQuestions1[0],usersRegister.userLogin.question2=usersRegister.userLogin.challengeQuestions2[0]}).then(function(){return API.cui.getOrganizationPackages({organizationId:usersRegister.targetOrganization.id})}).then(function(res){var listOfApps=[];res.forEach(function(packageGrant){var i=0;API.cui.getPackageServices({packageId:packageGrant.servicePackage.id}).then(function(res){i++,res.forEach(function(service){service.packageId=packageGrant.servicePackage.id,listOfApps.push(service)}),i===res.length&&(usersRegister.applications.list=listOfApps,$scope.$digest())})})}).fail(function(err){console.log(err)}),usersRegister.applications.updateNumberOfSelected=function(a){null!==a?usersRegister.applications.numberOfSelected++:usersRegister.applications.numberOfSelected--},usersRegister.applications.process=function(){if(usersRegister.applications.processedSelected)var oldSelected=usersRegister.applications.processedSelected;return usersRegister.applications.processedSelected=[],angular.forEach(usersRegister.applications.selected,function(app,i){null!==app&&usersRegister.applications.processedSelected.push({packageId:app.split(",")[0],name:app.split(",")[1],acceptedTos:oldSelected&&oldSelected[i]?oldSelected[i].acceptedTos:!1})}),usersRegister.applications.processedSelected.length},usersRegister.applications.searchApplications=function(){API.cui.getPackages({qs:[["name",usersRegister.applications.search]]}).then(function(res){usersRegister.applications.list=res,$scope.$digest()}).fail(function(err){console.log(err)})},usersRegister.applications.toggleCovisintInfo=function(){usersRegister.showCovisintInfo=!usersRegister.showCovisintInfo},usersRegister.submit=function(){usersRegister.submitting=!0;var user;API.doAuth().then(function(){return API.cui.updatePerson({personId:usersRegister.invitedUser.id,data:build.user()})}).then(function(res){return user=res,API.cui.createPersonPassword(build.personPassword(user,usersRegister.targetOrganization))}).then(function(){return API.cui.createSecurityQuestionAccount(build.userSecurityQuestionAccount(user))}).then(function(){return API.cui.activatePerson({qs:[["personId",user.id]]})}).then(function(){return build.packagesSelected()}).then(function(res){0!==res.length&&angular.forEach(res,function(servicePackage){var i=0;API.cui.createPackageRequest(build.packageRequest(servicePackage)).then(function(res){i++,i===res.length&&(usersRegister.submitting=!1,usersRegister.success=!0,console.log("User Created"),$state.go("misc.success"))}).fail(function(err){console.log(err)})})}).fail(function(err){console.log(err)})};var build={user:function(){return usersRegister.user.addresses[0].country=usersRegister.userCountry.title,usersRegister.user.organization={id:usersRegister.targetOrganization.id,realm:usersRegister.targetOrganization.realm,type:"organization"},usersRegister.user.timezone="EST5EDT",usersRegister.user.phones[0]&&(usersRegister.user.phones[0].type="main"),usersRegister.user.language=$scope.$parent.base.getLanguageCode(),usersRegister.user},personPassword:function(user,org){return{personId:user.id,data:{id:user.id,version:"1",username:usersRegister.userLogin.username,password:usersRegister.userLogin.password,passwordPolicy:org.passwordPolicy,authenticationPolicy:org.authenticationPolicy}}},userSecurityQuestions:function(user){return[{question:{id:usersRegister.userLogin.question1.id,type:"question",realm:user.realm},answer:usersRegister.userLogin.challengeAnswer1,index:1},{question:{id:usersRegister.userLogin.question2.id,type:"question",realm:user.realm},answer:usersRegister.userLogin.challengeAnswer2,index:2}]},userSecurityQuestionAccount:function(user){return{personId:user.id,data:{version:"1",id:user.id,questions:this.userSecurityQuestions(user)}}},packagesSelected:function(){var packages=[];return angular.forEach(usersRegister.applications.selected,function(servicePackage){
packages.push({packageId:servicePackage.split(",")[0]})}),packages},packageRequest:function(packageId){return{data:{requestor:{id:usersRegister.user.id,type:"person"},servicePackage:{id:packageId.packageId,type:"servicePackage"},reason:"Invited User Registration"}}}}}]),angular.module("app").controller("usersWalkupCtrl",["localStorageService","$scope","Person","$stateParams","API","LocaleService","$state",function(localStorageService,$scope,Person,$stateParams,API,LocaleService,$state){function handleError(err){console.log("Error!\n"),console.log(err)}var usersWalkup=this;usersWalkup.userLogin={},usersWalkup.applications={},usersWalkup.registering=!1,usersWalkup.registrationError=!1,usersWalkup.applications.numberOfSelected=0,localStorageService.get("usersWalkup.user")?usersWalkup.user=localStorageService.get("usersWalkup.user"):(usersWalkup.user={addresses:[]},usersWalkup.user.addresses[0]={streets:[]},usersWalkup.user.phones=[]),$scope.$watch("usersWalkup.user",function(a){a&&0!==Object.keys(a).length&&localStorageService.set("usersWalkup.user",a)},!0),API.doAuth().then(function(res){return API.cui.getSecurityQuestions()}).then(function(res){res.splice(0,1);var numberOfQuestions=res.length,numberOfQuestionsFloor=Math.floor(numberOfQuestions/2);return usersWalkup.userLogin.challengeQuestions1=res.slice(0,numberOfQuestionsFloor),usersWalkup.userLogin.challengeQuestions2=res.slice(numberOfQuestionsFloor),usersWalkup.userLogin.question1=usersWalkup.userLogin.challengeQuestions1[0],usersWalkup.userLogin.question2=usersWalkup.userLogin.challengeQuestions2[0],API.cui.getOrganizations()}).then(function(res){usersWalkup.organizationList=res}).fail(handleError);var searchOrganizations=function(newOrgToSearch){newOrgToSearch&&API.cui.getOrganizations({qs:[["name",newOrgToSearch.name]]}).then(function(res){usersWalkup.organizationList=res,$scope.$apply()}).fail(handleError)};$scope.$watchCollection("usersWalkup.orgSearch",searchOrganizations),$scope.$watch("usersWalkup.organization",function(newOrgSelected){newOrgSelected&&(usersWalkup.applications.numberOfSelected=0,usersWalkup.applications.processedSelected=void 0,API.cui.getPackages({qs:[["owningOrganization.id",newOrgSelected.id]]}).then(function(res){0===res.length?usersWalkup.applications.list=void 0:usersWalkup.applications.list=res,$scope.$apply()}).fail(handleError))}),usersWalkup.applications.updateNumberOfSelected=function(checkboxValue){null!==checkboxValue?usersWalkup.applications.numberOfSelected++:usersWalkup.applications.numberOfSelected--},usersWalkup.applications.process=function(){if(usersWalkup.applications.processedSelected)var oldSelected=usersWalkup.applications.processedSelected;return usersWalkup.applications.processedSelected=[],angular.forEach(usersWalkup.applications.selected,function(app,i){null!==app&&usersWalkup.applications.processedSelected.push({id:app.split(",")[0],name:app.split(",")[1],acceptedTos:oldSelected&&oldSelected[i]?oldSelected[i].acceptedTos:!1})}),usersWalkup.applications.processedSelected.length},usersWalkup.applications.searchApplications=function(){API.cui.getPackages({qs:[["name",usersWalkup.applications.search],["owningOrganization.id",usersWalkup.organization.id]]}).then(function(res){usersWalkup.applications.list=res,$scope.$apply()}).fail(handleError)},usersWalkup.submit=function(){usersWalkup.submitting=!0;var user,org;API.cui.createPerson({data:build.user()}).then(function(res){return user=res,API.cui.getOrganization({organizationId:user.organization.id})}).then(function(res){return org=res,API.cui.createSecurityQuestionAccount(build.userSecurityQuestionAccount(user))}).then(function(){return API.cui.createPersonPassword(build.personPassword(user,org))}).then(function(){return API.cui.createPersonRequest(build.personRequest(user,org))}).then(function(){usersWalkup.submitting=!1,usersWalkup.success=!0,console.log("userCreated."),$state.go("misc.success")}).fail(function(err){usersWalkup.success=!1,handleError(err)})};var build={personRequest:function(user,org){return{data:{id:user.id,registrant:{id:user.id,type:"person",realm:org.realm},justification:"User walkup registration.",servicePackageRequest:this.packageRequests()}}},packageRequests:function(){var packages={packageId:usersWalkup.applications.selected[0].split(",")[0]};return packages},personPassword:function(user,org){return{personId:user.id,data:{version:"1",username:usersWalkup.userLogin.username,password:usersWalkup.userLogin.password,passwordPolicy:org.passwordPolicy,authenticationPolicy:org.authenticationPolicy}}},userSecurityQuestionAccount:function(user){return{personId:user.id,data:{version:"1",id:user.id,questions:this.userSecurityQuestions(user)}}},user:function(){return usersWalkup.user.addresses[0].country=usersWalkup.userCountry.title,usersWalkup.user.organization={id:usersWalkup.organization.id},usersWalkup.user.timezone="EST5EDT",usersWalkup.user.phones[0]&&(usersWalkup.user.phones[0].type="main"),usersWalkup.user.language=$scope.$parent.base.getLanguageCode(),usersWalkup.user},userSecurityQuestions:function(user){return[{question:{id:usersWalkup.userLogin.question1.id,type:"question",realm:user.realm},answer:usersWalkup.userLogin.challengeAnswer1,index:1},{question:{id:usersWalkup.userLogin.question2.id,type:"question",realm:user.realm},answer:usersWalkup.userLogin.challengeAnswer2,index:2}]}}}]),angular.module("app").controller("usersActivateCtrl",["$stateParams","API","Person",function($stateParams,API,Person){var personParams=[{name:"personId",value:$stateParams.id}];API.cui.activatePerson({params:personParams}).then(function(res){return Person.grantCcaPackage($stateParams.id)}).then(function(res){return Person.grantExchangePackage($stateParams.id)}).then(function(res){console.log(res)}).fail(function(err){console.log(err)})}]),angular.module("app").controller("usersSearchCtrl",["localStorageService","$scope","API","Person",function(localStorageService,$scope,API,Person){var usersSearch=this;usersSearch.listLoading=!0,API.doAuth().then(function(){API.cui.getPersons().then(function(res){usersSearch.listLoading=!1,usersSearch.list=res,usersSearch.list.splice(0,4),$scope.$apply()}).fail(function(err){usersSearch.listLoading=!1})});var search=function(){usersSearch.search&&(console.log(usersSearch.search),API.cui.getPersons({data:usersSearch.search}).then(function(res){usersSearch.list=res,$scope.$apply()}).fail(function(err){}))};$scope.$watchCollection("usersSearch.search",search)}]),angular.module("app").controller("welcomeCtrl",["$scope",function($scope){}])}(angular);